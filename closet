#!/usr/bin/python3
# SPDX-FileCopyrightText: 2025 yuki hoya
# SPDX-License-Identifier: BSD-3-Clause

"""服のリストを季節ごとにまとめて表示するコマンド。"""

import sys


def parse_line(raw_line: str):
    """1行を '季節,カテゴリ,色,名前' に分解する。"""
    line = raw_line.strip()
    parts = line.split(",")
    if len(parts) != 4:
        # フォーマットがおかしい行は呼び出し側でエラー処理する
        raise ValueError("行の形式が '季節,カテゴリ,色,名前' ではありません")

    # 各要素の前後の空白も削る
    season, category, color, name = [p.strip() for p in parts]
    return season, category, color, name


def main():
    # 季節をキー，その季節の服のリストを値にした辞書
    items_by_season = {}
    had_input = False

    # 入力元の決定：
    # 引数がなければ標準入力，
    # 引数が1つあればそのファイルから読む
    if len(sys.argv) == 1:
        input_stream = sys.stdin
    elif len(sys.argv) == 2:
        path = sys.argv[1]
        try:
            input_stream = open(path, encoding="utf-8")
        except OSError as e:
            sys.stderr.write(f"Error: ファイル '{path}' を開けませんでした: {e}\n")
            sys.exit(1)
    else:
        # 引数が多すぎるとき
        sys.stderr.write("Usage: closet [clothes.txt]\n")
        sys.exit(1)

    for raw in input_stream:
        stripped = raw.strip()
        # 空行だけの行は無視
        if stripped == "":
            continue

        # 先頭が # の行はコメントとして無視
        if stripped.startswith("#"):
            continue

        had_input = True
        try:
            season, category, color, name = parse_line(raw)
        except ValueError as e:
            # エラーメッセージは標準エラー出力へ
            sys.stderr.write(f"Error: {e}: {raw}")
            sys.exit(1)

        # 季節ごとにリストに追加
        items_by_season.setdefault(season, []).append(
            (category, color, name)
        )

    # ファイルから読んでいた場合は閉じておく（stdinのときは何もしない）
    if input_stream is not sys.stdin:
        input_stream.close()

    # 有効なデータが1つもなかった場合もエラーにする
    if not had_input or not items_by_season:
        sys.stderr.write("Error: 標準入力やファイルから服のデータが読み込めませんでした\n")
        sys.exit(1)

    # 季節名でソートして出力
    for season in sorted(items_by_season.keys()):
        print(f"{season}:")
        for category, color, name in items_by_season[season]:
            print(f"  {category} {color} {name}")


if __name__ == "__main__":
    main()

